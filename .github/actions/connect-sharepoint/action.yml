name: "Connect to SharePoint"
description: "Reusable composite action to connect with PnP.PowerShell"

inputs:
  siteUrl:
    description: "SharePoint site URL"
    required: true
  clientId:
    description: "Azure AD App Client ID"
    required: true
  clientSecret:
    description: "Azure AD App Client Secret"
    required: true
  tenant:
    description: "Tenant name (e.g. tuorg.onmicrosoft.com)"
    required: true

runs:
  using: "composite"
  steps:
    - name: Install PnP.PowerShell
      shell: pwsh
      run: |
        Install-Module -Name PnP.PowerShell -Force -Scope CurrentUser -AllowClobber

    - name: Connect to SharePoint
      shell: pwsh
      run: |
        $clientSecretPlain = "${{ inputs.clientSecret }}"

        if ([string]::IsNullOrWhiteSpace($clientSecretPlain)) {
          Write-Error "Missing clientSecret input"
          exit 1
        }

        # Do not convert the secret to a SecureString; pass the plain secret string to Connect-PnPOnline
        Connect-PnPOnline `
          -Url "${{ inputs.siteUrl }}" `
          -ClientId "${{ inputs.clientId }}" `
          -ClientSecret $clientSecretPlain `
          -Tenant "${{ inputs.tenant }}"